#!/usr/bin/env bash
# SPDX-License-Identifier: MPL-2.0
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
# shellcheck source=common.sh
source "${SCRIPT_DIR}/common.sh"

activate_venv

FIX_MODE=0
ARGS=()
for arg in "$@"; do
    if [[ "$arg" == "--fix" ]]; then
        FIX_MODE=1
    else
        ARGS+=("$arg")
    fi
done

RUFF_ARGS=("check")
if [[ ${FIX_MODE} -eq 1 ]]; then
    RUFF_ARGS+=("--fix")
fi
if [[ ${#ARGS[@]} -gt 0 ]]; then
    RUFF_ARGS+=("${ARGS[@]}")
fi

ruff "${RUFF_ARGS[@]}" || abort "ruff check failed"

if [[ ${FIX_MODE} -eq 1 ]]; then
    black .
    isort src tests
else
    black --check .
    isort --check-only src tests
fi

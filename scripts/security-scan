#!/usr/bin/env bash
# SPDX-License-Identifier: MPL-2.0
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
# shellcheck source=common.sh
source "${SCRIPT_DIR}/common.sh"

activate_venv

for tool in pip-audit bandit detect-secrets; do
    if ! command -v "$tool" >/dev/null 2>&1; then
        abort "${tool} is not installed. Run scripts/bootstrap to provision dev dependencies."
    fi
done

pip-audit -r requirements.txt "$@"
bandit -q -r src

detect-secrets scan --all-files --force-use-all-plugins > ci/detect-secrets-report.json
